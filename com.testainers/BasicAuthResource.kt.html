<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BasicAuthResource.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">httpbucket</a> &gt; <a href="index.source.html" class="el_package">com.testainers</a> &gt; <span class="el_source">BasicAuthResource.kt</span></div><h1>BasicAuthResource.kt</h1><pre class="source lang-java linenums">package com.testainers

import io.quarkus.security.Authenticated
import io.vertx.core.http.HttpServerRequest
import jakarta.ws.rs.*
import jakarta.ws.rs.core.HttpHeaders
import jakarta.ws.rs.core.MediaType
import jakarta.ws.rs.core.Response
import jakarta.ws.rs.core.UriInfo
import org.eclipse.microprofile.openapi.annotations.responses.APIResponse
import org.eclipse.microprofile.openapi.annotations.responses.APIResponses
import org.jboss.resteasy.reactive.RestHeader
import java.nio.charset.StandardCharsets
import java.util.*

/**
 * @author Eduardo Folly
 */
<span class="fc" id="L19">@Authenticated</span>
@Path(&quot;/basic-auth/{user}/{pass}&quot;)
@APIResponses(
    APIResponse(responseCode = &quot;200&quot;),
    APIResponse(responseCode = &quot;401&quot;),
    APIResponse(responseCode = &quot;403&quot;),
)
@Produces(MediaType.APPLICATION_JSON)
<span class="fc" id="L27">class BasicAuthResource(</span>
<span class="fc" id="L28">    val request: HttpServerRequest,</span>
<span class="fc" id="L29">    val uriInfo: UriInfo,</span>
) {
    @GET
    fun get(
        @RestHeader(HttpHeaders.AUTHORIZATION) auth: String?,
        user: String,
        pass: String,
<span class="fc" id="L36">    ): Response = getResponse(auth, user, pass, null)</span>

    @POST
    fun post(
        @RestHeader(HttpHeaders.AUTHORIZATION) auth: String?,
        user: String,
        pass: String,
        body: Any?,
<span class="fc" id="L44">    ): Response = getResponse(auth, user, pass, body)</span>

    @PUT
    fun put(
        @RestHeader(HttpHeaders.AUTHORIZATION) auth: String?,
        user: String,
        pass: String,
        body: Any?,
<span class="fc" id="L52">    ): Response = getResponse(auth, user, pass, body)</span>

    @PATCH
    fun patch(
        @RestHeader(HttpHeaders.AUTHORIZATION) auth: String?,
        user: String,
        pass: String,
        body: Any?,
<span class="fc" id="L60">    ): Response = getResponse(auth, user, pass, body)</span>

    @DELETE
    fun delete(
        @RestHeader(HttpHeaders.AUTHORIZATION) auth: String?,
        user: String,
        pass: String,
        body: Any?,
<span class="fc" id="L68">    ): Response = getResponse(auth, user, pass, body)</span>

    @HEAD
    fun head(
        @RestHeader(HttpHeaders.AUTHORIZATION) auth: String?,
        user: String,
        pass: String,
<span class="fc" id="L75">    ): Response = getResponse(auth, user, pass, null)</span>

    private fun getResponse(
        auth: String?,
        user: String,
        pass: String,
        body: Any?,
    ): Response {
<span class="fc" id="L83">        val responseBody = ResponseBody(request, uriInfo, body)</span>
<span class="fc" id="L84">        var code = 403</span>

<span class="fc" id="L86">        val bodyMap: MutableMap&lt;String, Any?&gt; = HashMap()</span>
<span class="fc" id="L87">        bodyMap[&quot;auth&quot;] = false</span>
<span class="fc" id="L88">        bodyMap[&quot;user&quot;] = user</span>
<span class="fc" id="L89">        bodyMap[&quot;pass&quot;] = pass</span>
<span class="fc" id="L90">        bodyMap[&quot;message&quot;] = &quot;Forbidden.&quot;</span>
<span class="fc" id="L91">        bodyMap[&quot;body&quot;] = body</span>

<span class="fc bfc" id="L93" title="All 2 branches covered.">        if (auth == null) {</span>
<span class="fc" id="L94">            code = 401</span>
<span class="fc" id="L95">            bodyMap[&quot;message&quot;] = &quot;Authorization header not present.&quot;</span>
        } else {
<span class="fc" id="L97">            val encoded =</span>
                Base64
<span class="fc" id="L99">                    .getEncoder()</span>
<span class="fc" id="L100">                    .encodeToString(</span>
<span class="fc" id="L101">                        &quot;$user:$pass&quot;.toByteArray(StandardCharsets.UTF_8),</span>
                    )

<span class="fc" id="L104">            val ok = auth == &quot;Basic $encoded&quot;</span>

<span class="fc" id="L106">            bodyMap[&quot;auth&quot;] = ok</span>

<span class="fc bfc" id="L108" title="All 2 branches covered.">            if (ok) {</span>
<span class="fc" id="L109">                code = 200</span>
<span class="fc" id="L110">                bodyMap[&quot;message&quot;] = &quot;Success.&quot;</span>
            }
        }

<span class="fc" id="L114">        responseBody.body = bodyMap</span>

<span class="fc" id="L116">        return Response.status(code).entity(responseBody).build()</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span>httpbucket</div></body></html>